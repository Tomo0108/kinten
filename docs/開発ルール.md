# 開発ルール

## ディレクトリ構造管理

### 基本ルール
1. **重複フォルダの禁止**: 同じ名前のフォルダが複数の場所に存在してはいけない
2. **階層追加時の記録**: 新しいディレクトリ構造を追加する際は、必ずこのファイルに記載する
3. **構造変更の記録**: ディレクトリ構造を変更した場合は、このファイルを更新する

### 現在のディレクトリ構造
```
kinten/
├── .git/
├── .history/
├── assets/
├── backend/
│   ├── __init__.py
│   ├── create_sample_template.py
│   ├── csv_processor.py
│   ├── excel_processor.py
│   ├── main_processor.py
│   ├── main.py
│   └── pdf_converter.py
├── build/
├── dist/                   # Flutterアプリの配布用ビルド成果物（正しい場所）
├── docs/                   # ドキュメント類の整理された場所
│   ├── README.md
│   ├── タスクリスト.md
│   ├── kinten_要件.md
│   ├── デザイン要件.md
│   ├── PDF変換機能修正タスクリスト.md
│   └── 開発ルール.md
├── frontend/
│   ├── assets/
│   │   ├── app_icon.png
│   │   └── app_icon.svg
│   ├── build/              # Flutter開発用ビルド成果物
│   ├── lib/
│   │   ├── main.dart
│   │   ├── providers/
│   │   │   └── app_state_provider.dart
│   │   ├── screens/
│   │   │   ├── home_screen_fixed.dart
│   │   │   └── home_screen.dart
│   │   ├── services/
│   │   │   ├── file_service.dart
│   │   │   └── settings_service.dart
│   │   └── widgets/
│   │       ├── file_selector.dart
│   │       ├── neumorphic_button.dart
│   │       ├── neumorphic_container.dart
│   │       ├── neumorphic_progress_indicator.dart
│   │       ├── neumorphic_text_field.dart
│   │       └── pdf_conversion_widget.dart
│   ├── test/
│   │   └── widget_test.dart
│   ├── windows/
│   │   ├── CMakeLists.txt
│   │   ├── flutter/
│   │   │   ├── CMakeLists.txt
│   │   │   ├── ephemeral/
│   │   │   ├── generated_plugin_registrant.cc
│   │   │   ├── generated_plugin_registrant.h
│   │   │   └── generated_plugins.cmake
│   │   └── runner/
│   │       ├── CMakeLists.txt
│   │       ├── flutter_window.cpp
│   │       ├── flutter_window.h
│   │       ├── main.cpp
│   │       ├── resource.h
│   │       ├── resources/
│   │       │   └── app_icon.ico
│   │       ├── runner.exe.manifest
│   │       ├── Runner.rc
│   │       ├── utils.cpp
│   │       ├── utils.h
│   │       ├── win32_window.cpp
│   │       └── win32_window.h
│   ├── .dart_tool/
│   ├── .idea/
│   ├── analysis_options.yaml
│   ├── pubspec.yaml
│   └── README.md
├── input/
├── output/
│   ├── 2025_01/
│   └── 2025_06/
├── templates/
├── .gitignore
├── check_environment.ps1
├── kinten_backend.spec
├── pyrightconfig.json
├── requirements.txt
└── README.md
```

## UIデザイン統一ルール

### 基本デザイン原則
1. **Neumorphicデザイン**: すべてのUIコンポーネントはNeumorphicContainerとNeumorphicButtonを使用
2. **カラーパレット統一**: 
   - プライマリカラー: `Color(0xFF3498DB)` (青)
   - セカンダリカラー: `Color(0xFF27AE60)` (緑)
   - エラーカラー: `Color(0xFFE74C3C)` (赤)
   - テキストカラー: `Color(0xFF2C3E50)` (濃いグレー)
   - 背景色: `Color(0xFFF8F9FA)` (薄いグレー)

### 文字サイズ統一ルール
1. **ラベルテキスト**: `fontSize: 14` (統一)
2. **ボタンテキスト**: `fontSize: 16` (統一)
3. **セクションタイトル**: `fontSize: 16` (統一)
4. **ヘッダーテキスト**: `fontSize: 18` (統一)
5. **パス表示テキスト**: `fontSize: 14` (統一)

### 説明機能統一ルール
1. **情報アイコン**: すべてのファイル選択項目に情報アイコン（`Icons.info_outline`）を配置
2. **説明ダイアログ**: 各機能の詳細説明をダイアログで表示
3. **アイコンサイズ**: `size: 16` (統一)
4. **アイコン背景**: `Color(0xFF3498DB).withOpacity(0.1)` (統一)

### コンポーネント統一ルール
1. **ファイル選択ウィジェット**: FileSelectorコンポーネントを基準とする
2. **ボタンデザイン**: NeumorphicButtonを使用し、アイコンとテキストの配置を統一
3. **パス表示**: 選択されたファイル/フォルダのパス表示デザインを統一
4. **セクション区切り**: 適切な余白（16px-20px）でセクションを区切る

### 削除済みの重複フォルダ
- ✅ `dist/` (ルートディレクトリ) - 削除完了
- ✅ `frontend/dist_new/` - 削除完了
- ✅ `frontend/dist/` - ルートディレクトリに移動完了

### 作業履歴
- 2025-08-05 09:00: 重複フォルダの削除とルールファイル作成
  - ルートディレクトリの `dist/` フォルダを削除
  - `frontend/dist_new/` フォルダを削除
  - `frontend/dist/` フォルダを正しい場所として維持
- 2025-08-05 09:45: ディレクトリ構造の正規化とドキュメント整理
  - `frontend/dist/` をルートディレクトリの `dist/` に移動（配布用ビルド成果物の正しい場所）
  - 散らばっていたmdファイルを `docs/` ディレクトリに整理
  - 開発ルールファイルを `docs/` に移動
- 2025-08-05 10:30: PDF変換機能のUIデザイン統一
  - PDF変換ウィジェットのヘッダーデザインを他のUIと統一
  - セクションヘッダーのデザインを統一（アイコン付きグラデーション背景）
  - フォルダ選択ウィジェットをNeumorphicContainerに統一
  - 全体的なデザインの一貫性を向上
- 2025-08-05 11:15: ファイル一覧表示機能の修正
  - Flutterアプリのパス解決ロジックを修正（frontendディレクトリ構造に対応）
  - Pythonバックエンド呼び出し時の環境変数を改善（PATH追加）
  - Pythonスクリプトにデバッグ情報を追加してエラー特定を容易化
  - 仮想環境のPythonパスを正しく設定
- 2025-08-05 12:00: 実行ボタンの独立化
  - 自動転記機能とPDF変換機能のステータス管理を完全に分離
  - 各機能に独立したステータス（autoTransferStatus, pdfConversionStatus）を実装
  - ボタンの状態管理を独立化して機能間の干渉を防止
  - ステータス表示セクションも機能別に分離
  - 後方互換性のためのメソッドを残しつつ、新しい独立したメソッドを追加
 - 2025-08-05 13:00: 自動転記処理の修正
   - CSVプロセッサーの列名検証を柔軟化（異なるCSV形式に対応）
   - 列名の統一化機能を追加（出勤時刻→始業時刻1、退勤時刻→終業時刻1等）
   - 日付形式の対応を拡張（YYYY-MM-DD形式に対応）
   - テスト用CSVファイルを作成して動作確認
   - 自動転記処理が正常に動作することを確認
 - 2025-08-05 14:00: タブ切り替え時のボタン表示修正
   - TabControllerにリスナーを追加してタブ切り替え時のUI更新を確実化
   - TabBarViewにキーを追加してタブ切り替え時の強制再構築を実装
   - デバッグログを追加してタブ切り替えの動作を詳細に追跡
   - タブに応じたボタン表示の確実性を向上
 - 2025-08-05 15:00: 転記処理エラーのデバッグ強化
   - Pythonバックエンドの直接テストで正常動作を確認
   - Flutterアプリからの呼び出し時のデバッグログを強化
   - ファイル存在チェックの詳細ログを追加
   - テンプレートパスとCSVパスの詳細情報を出力
 - 2025-08-05 16:00: 転記処理エラーの根本原因調査
   - Pythonバックエンドの段階的テスト（CSV、Excel、統合処理）
   - FlutterアプリのPythonプロセス実行結果の詳細ログ追加
   - _handlePythonResultメソッドのデバッグ情報強化
   - エラーハンドリングの改善と詳細なログ出力
 - 2025-08-05 17:00: PDF変換機能のUI完全再構築
   - 謎の白いアイコンの削除
   - 「ファイル設定」項目の削除
   - 入力フォルダ選択ボタンの視認性大幅改善
   - シンプルで使いやすいデザインへの変更
   - FileService.pickDirectoryメソッドの正しい使用
   - 転記処理コードへの影響なし
 - 2025-08-05 18:00: 自動転記処理ロジックの最適化
   - H5セルの月数を「06」→「6」形式に変更（先頭の0を除去）
   - AB列（日付と曜日）の編集を停止（雛形ファイルの関数が自動生成）
   - 雛形ファイルの関数を活用した効率的なデータ転記
   - 手動編集によるエラーリスクの削減
 - 2025-08-05 19:00: PDF変換機能のUI改善
   - 選択ボタンの位置を適切に配置（宙に浮いていた問題を解決）
   - 入力フォルダのパス表示機能を追加
   - 自動転記のFileSelectorデザインを参考にした統一的なUI
   - NeumorphicContainerを使用した一貫性のあるデザイン
 - 2025-08-05 20:00: UIデザイン統一ルールの策定
   - 文字サイズの統一ルールを策定（ラベル14px、ボタン16px、セクション16px、ヘッダー18px）
   - 説明機能の統一ルールを策定（情報アイコンとダイアログの必須化）
   - カラーパレットの統一ルールを策定
   - コンポーネントデザインの統一基準を策定
   - ディレクトリ構造の詳細化（frontend/lib配下の詳細構造を追加）
 - 2025-08-05 21:00: PDF変換機能のUI統一実装
   - 転記処理のFileSelectorデザインを参考にした統一的なUI実装
   - 文字サイズの統一（ラベル14px、ボタン16px、パス表示14px）
   - 情報アイコンと説明ダイアログの追加（PDF変換機能、Excelファイル一覧）
   - ボタンデザインの統一（NeumorphicButton、アイコンサイズ20px、余白12px）
   - パス表示デザインの統一（背景色、アイコン、テキストスタイル）
 - 2025-08-05 21:30: 作業履歴の日時記録ルール追加
   - 作業履歴に日付と時間を記録するルールを追加
   - 時系列での作業追跡を容易にするための改善
 - 2025-08-05 22:00: PDF変換機能のリスト表示エラー対策強化
   - ファイルサイズ表示機能を追加（B、KB、MB、GB形式）
   - null安全性の強化（fileSizeのデフォルト値設定）
   - リスト表示の情報量向上（ファイル名とサイズの両方表示）
   - エラーが起こらない安全な実装の確認と改善
 - 2025-08-05 22:30: Flutterアプリのビルド完了
   - 構文エラーの修正（PDF変換ウィジェットの配列構文）
   - Windows用リリースビルドの成功
   - 配布用ファイルの準備完了（kinten.exe、backend、requirements.txt、README.md）
   - 仮想環境でのテスト完了による品質保証
 - 2025-08-05 22:45: Pylanceエラーの修正
   - create_test_excel.pyの型安全性向上
   - openpyxlのWorksheetとCellの型チェック追加
   - Noneチェックによるnull安全性の確保
 - 2025-08-05 23:00: PDF変換UIの統一修正
   - PDF変換アイコンのぼかし効果（boxShadow）を削除
   - フォントサイズを自動転記UIと同じ14pxに統一
   - フォントウェイトをFontWeight.w600に統一
 - 2025-08-05 23:15: Excelファイルリスト表示エラーの修正
   - Pythonスクリプト実行時の仮想環境パス解決を改善
   - 仮想環境が存在しない場合はシステムPythonを使用
   - stdoutからのJSONレスポンス抽出機能を追加
   - エラーハンドリングの強化
 - 2025-08-05 23:30: 本番環境対応のための仮想環境依存削除
   - すべてのPython実行でシステムPythonを優先使用
   - 仮想環境パス参照を完全に削除
   - 本番環境での動作を考慮したエラーメッセージに変更
   - PythonとFlutterのない環境でも動作するよう準備
- 2025-08-05 23:45: 最終ビルド完了
   - 不要なdistフォルダ（.history内）を削除
   - Windows用リリースビルドの成功
   - 配布用ファイルの準備完了（kinten.exe、backend、requirements.txt、README.md）
   - 本番環境対応の仮想環境依存削除を反映した最終版
- 2025-08-05 23:50: PDF変換ヘッダーの文字サイズ統一
   - PDF変換の文字サイズを自動転記機能の「基本情報」と同じに修正
   - フォントサイズ: isSmallScreen ? 18 : 22
   - フォントウェイト: FontWeight.bold
   - UIの一貫性を完全に統一
- 2025-08-05 23:55: PDF変換ヘッダーの完全統一
   - 説明文「ExcelファイルをPDFに変換してください」を追加
   - アイコンサイズを基本情報と同じに統一（18-22px）
   - アイコンコンテナのパディングとボーダーラジウスも統一
   - 自動転記機能との完全なUI一貫性を実現
- 2025-08-06 00:30: PythonとFlutterの連携テスト完了
   - Excelファイルリストアップ機能の動作確認完了
   - Flutterアプリのビルド成功（SettingsServiceの従業員名機能追加）
   - PythonバックエンドとFlutterアプリの連携テスト成功
   - JSON形式でのデータ受け渡しが正常に動作することを確認
   - ファイルサイズ表示機能の動作確認完了
   - 配布用ファイルの準備完了（dist/ディレクトリ）
- 2025-08-06 00:45: 最終ビルド完了
   - 実行中プロセスの終了処理（kinten.exeの強制終了）
   - Windows用リリースビルドの成功
   - 配布用ファイルの更新完了（最新版のkinten.exe、backend、requirements.txt、README.md）
   - 本番環境での動作確認準備完了
- 2025-08-06 01:00: 重複ファイルのクリーンアップ完了
   - dist/backend/backend/（重複ディレクトリ）を削除
   - dist/Release/（重複ディレクトリ）を削除
   - dist/debug_python_code.py（不要ファイル）を削除
   - __pycache__ディレクトリを削除（backend/、dist/backend/）
   - test_empty/、test_input/（テスト用ディレクトリ）を削除
   - 配布用ファイルの整理完了
- 2025-08-06 02:00: Windows用アプリビルド完了
   - FlutterアプリのWindows用リリースビルド成功
   - 配布用ファイルの準備完了（kinten.exe、backend、requirements.txt、README.md）
   - 必要なDLLファイル（flutter_windows.dll、permission_handler_windows_plugin.dll）の配置完了
   - アプリデータディレクトリ（data/）の配置完了
   - Mac用ビルドはMac環境での実行が必要（現在Windows環境のため実行不可）
- 2025-08-06 02:15: UI改善とパフォーマンス最適化完了
   - 「選択されたファイル」のUI位置を調整（パディングとマージンを拡大）
   - Excelファイル選択時のプレビュー機能を完全無効化（withPreview: false）
   - 複数ファイル選択の改善（コントロールキー不要で複数選択可能）
   - FileSelectorとPDF変換ウィジェットのUI統一（余裕のあるレイアウト）
   - ファイル選択時のパフォーマンス向上（lockParentWindow: true）

## 本番環境での動作に関する注意事項

### Python実行環境
- **システムPython優先**: 仮想環境への依存を削除し、システムにインストールされたPythonを使用
- **必要なライブラリ**: 本番環境では`requirements.txt`に記載されたライブラリをシステムにインストール
- **エラーメッセージ**: 仮想環境に関する記述を削除し、システムインストールを促すメッセージに変更

### 配布時の考慮事項
- **Python依存**: 本番環境ではPythonがインストールされている必要がある
- **ライブラリ依存**: 必要なPythonライブラリがシステムにインストールされている必要がある
- **パス解決**: 相対パスでのPython実行により、配布先での動作を考慮

## ビルド先の明確な指定

### Flutterアプリのビルド先
- **開発用ビルド**: `frontend/build/` (Flutter開発時の一時的なビルド成果物)
- **配布用ビルド**: `dist/` (ルートディレクトリ、本番配布用の最終成果物)

### Pythonバックエンドのビルド先
- **PyInstallerビルド**: `build/` (ルートディレクトリ、中間ファイル)
- **実行可能ファイル**: `dist/kinten.exe` (最終的な配布用実行ファイル)

### ビルド時の注意事項
1. **Flutterビルド**: `flutter build windows --release` を実行する際は、必ず `frontend/` ディレクトリで実行
2. **配布用ファイル**: `dist/` ディレクトリに以下のファイルを配置
   - `kinten.exe` (Flutterアプリの実行ファイル)
   - `backend/` (Pythonバックエンドのソースコード)
   - `requirements.txt` (Python依存関係)
   - `README.md` (使用方法)
3. **ビルド成果物の管理**: `build/` と `dist/` ディレクトリは `.gitignore` で除外されているため、コミットしない

### ビルドコマンド例
```bash
# Flutterアプリのビルド（frontendディレクトリで実行）
cd frontend
flutter build windows --release

# 配布用ファイルの準備
# dist/ディレクトリに必要なファイルをコピー
```

## コミットメッセージルール
- コミットメッセージは一行で簡潔に記述する

## 言語ルール
- 常に日本語で応答する

## 問題発生時の対応
- 指摘された問題や問題行動は、このルールファイルに追記して次回に活かす
- ルール違反が発生した場合は、即座にこのファイルを更新する 